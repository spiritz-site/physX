<!DOCTYPE html>
<html lang="kk" data-theme="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>physX | –°—ã–Ω–∞–º–∞ “∞–ë–¢</title>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    /* CORE THEME VARIABLES */
    :root {
      --primary: #00f2a0;
      --primary-glow: rgba(0, 242, 160, 0.4);
      --accent: #00E0FF;
      --bg-body: #050505;
      --bg-gradient: radial-gradient(circle at 50% 0%, #1a3235 0%, #050505 60%);
      --surface: rgba(20, 20, 20, 0.7);
      --surface-border: rgba(255, 255, 255, 0.08);
      --text-main: #FFFFFF;
      --text-sec: #888888;
      --danger: #EB5757;
      --success: #27AE60;
      --ai-gradient: linear-gradient(135deg, #00f2a0 0%, #00E0FF 100%);
      --font: 'Manrope', sans-serif;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
      outline: none;
    }

    body {
      font-family: var(--font);
      background: var(--bg-body);
      background-image: var(--bg-gradient);
      color: var(--text-main);
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* GLASSMORPHISM CARD UTILITY */
    .glass-panel {
      background: var(--surface);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--surface-border);
      border-radius: 24px;
    }

    /* HEADER */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      z-index: 10;
    }

    .brand-logo {
      font-weight: 800;
      font-size: 18px;
      letter-spacing: -0.5px;
    }

    .close-btn {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: 0.2s;
    }

    .close-btn:active {
      transform: scale(0.9);
      background: rgba(255, 255, 255, 0.2);
    }

    /* QUIZ CONTAINER */
    .quiz-layout {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 0 20px 40px 20px;
      max-width: 600px;
      margin: 0 auto;
      width: 100%;
      position: relative;
    }

    /* PROGRESS HEADER */
    .progress-area {
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
    }

    .q-counter {
      font-size: 13px;
      color: var(--text-sec);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .score-badge {
      font-size: 14px;
      font-weight: 700;
      color: var(--primary);
      background: rgba(0, 242, 160, 0.1);
      padding: 4px 12px;
      border-radius: 100px;
    }

    /* QUESTION CARD */
    .question-card {
      padding: 30px 20px;
      text-align: center;
      margin-bottom: 24px;
      min-height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    }

    .q-text {
      font-size: 18px;
      font-weight: 700;
      line-height: 1.5;
      animation: fadeUp 0.4s ease-out;
    }

    .topic-tag {
      font-size: 12px;
      color: var(--accent);
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 700;
    }

    /* OPTIONS GRID */
    .options-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      width: 100%;
    }

    .option-btn {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--surface-border);
      padding: 18px 20px;
      border-radius: 16px;
      color: var(--text-main);
      font-size: 15px;
      font-weight: 600;
      font-family: var(--font);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 16px;
      transition: all 0.2s ease;
      position: relative;
      text-align: left;
    }

    .option-btn:active {
      transform: scale(0.98);
      background: rgba(255, 255, 255, 0.06);
    }

    .opt-letter {
      width: 32px;
      height: 32px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 800;
      color: var(--text-sec);
      flex-shrink: 0;
      transition: 0.2s;
    }

    .option-btn:hover .opt-letter {
      background: var(--text-main);
      color: #000;
    }

    /* STATES */
    .correct-state {
      background: rgba(39, 174, 96, 0.2) !important;
      border-color: var(--success) !important;
      box-shadow: 0 0 20px rgba(39, 174, 96, 0.2);
    }

    .correct-state .opt-letter {
      background: var(--success);
      color: #fff;
    }

    .wrong-state {
      background: rgba(235, 87, 87, 0.15) !important;
      border-color: var(--danger) !important;
      opacity: 0.6;
    }

    .wrong-state .opt-letter {
      background: var(--danger);
      color: #fff;
    }

    .disabled {
      pointer-events: none;
    }

    /* RESULTS SCREEN */
    .result-overlay {
      position: fixed;
      inset: 0;
      background: var(--bg-body);
      background-image: var(--bg-gradient);
      z-index: 20;
      display: none;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
      animation: fadeIn 0.5s;
      overflow-y: auto;
      /* Allow scrolling for analysis */
    }

    .res-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .main-score {
      font-size: 48px;
      font-weight: 800;
      color: var(--text-main);
      line-height: 1;
      margin-bottom: 8px;
    }

    .feedback-txt {
      color: var(--text-sec);
      font-size: 16px;
      margin-bottom: 20px;
    }

    /* ANALYSIS SECTION */
    .analysis-card {
      width: 100%;
      max-width: 340px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--surface-border);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 20px;
      text-align: left;
    }

    .analysis-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-sec);
      margin-bottom: 12px;
      text-transform: uppercase;
    }

    .weak-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .weak-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .w-name {
      font-size: 15px;
      font-weight: 600;
      color: #fff;
    }

    .w-val {
      font-size: 14px;
      color: var(--danger);
      font-weight: 700;
    }

    /* BUTTONS */
    .action-btn {
      width: 100%;
      max-width: 340px;
      padding: 16px;
      border-radius: 14px;
      border: none;
      font-weight: 700;
      font-size: 15px;
      font-family: var(--font);
      cursor: pointer;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: transform 0.2s;
    }

    .action-btn:active {
      transform: scale(0.97);
    }

    .btn-ai {
      background: var(--ai-gradient);
      color: #000;
      box-shadow: 0 10px 30px rgba(0, 224, 255, 0.2);
      position: relative;
      overflow: hidden;
    }

    /* Shine effect */
    .btn-ai::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 50%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      animation: shine 3s infinite;
    }

    .btn-primary {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      border: 1px solid var(--surface-border);
    }

    .btn-sec {
      background: transparent;
      color: var(--text-sec);
    }

    @keyframes shine {
      0% {
        left: -100%;
      }

      20% {
        left: 200%;
      }

      100% {
        left: 200%;
      }
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    /* TOAST */
    #toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--surface);
      backdrop-filter: blur(10px);
      border: 1px solid var(--primary);
      color: var(--primary);
      padding: 12px 24px;
      border-radius: 100px;
      font-weight: 600;
      font-size: 14px;
      opacity: 0;
      pointer-events: none;
      transition: 0.3s;
      z-index: 100;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #toast.show {
      opacity: 1;
      top: 40px;
    }

    /* COURSE LOADING MODAL */
    .course-loader {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 30;
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    .loader-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid var(--surface-border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>

  <div id="toast">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
    <span>–î“±—Ä—ã—Å –∂–∞—É–∞–ø!</span>
  </div>

  <div class="top-bar">
    <div class="brand-logo">physX <span style="color:var(--primary)">.kz</span></div>
    <button class="close-btn" onclick="history.back()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <div class="quiz-layout" id="quizUI">
    <div class="progress-area">
      <div class="q-counter">–°“±—Ä–∞“õ <span id="currQ" style="color:var(--text-main); font-size:16px;">1</span> / 10</div>
      <div class="score-badge"><span id="scoreVal">0</span> XP</div>
    </div>

    <div class="glass-panel question-card">
      <div class="topic-tag" id="topicTag">–ö–∏–Ω–µ–º–∞—Ç–∏–∫–∞</div>
      <div class="q-text" id="questionText">–ñ“Ø–∫—Ç–µ–ª—É–¥–µ...</div>
    </div>

    <div class="options-grid" id="optionsGrid"></div>
  </div>

  <div class="result-overlay" id="resultUI">
    <div class="res-header">
      <div class="main-score" id="finalScore">0</div>
      <div class="feedback-txt" id="feedbackText">–ù”ô—Ç–∏–∂–µ –µ—Å–µ–ø—Ç–µ–ª—É–¥–µ...</div>
    </div>

    <div class="analysis-card" id="analysisBlock" style="display:none;">
      <div class="analysis-title">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          style="margin-right:5px; vertical-align:middle">
          <path d="M2 12h20M2 12l5-5m-5 5l5 5" />
        </svg>
        ”ò–ª—Å—ñ–∑ —Ç–∞“õ—ã—Ä—ã–ø—Ç–∞—Ä
      </div>
      <div id="weakList">
      </div>
    </div>

    <button class="action-btn btn-ai" onclick="generatePersonalCourse()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path
          d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83" />
      </svg>
      –ñ–µ–∫–µ –∫—É—Ä—Å “õ“±—Ä–∞—Å—Ç—ã—Ä—É (AI)
    </button>

    <button class="action-btn btn-primary" onclick="location.reload()">“ö–∞–π—Ç–∞ —Ç–∞–ø—Å—ã—Ä—É</button>
    <button class="action-btn btn-sec" onclick="history.back()">–®—ã“ì—É</button>
  </div>

  <div class="course-loader" id="courseLoader">
    <div class="loader-spinner"></div>
    <div style="font-weight:600; color:var(--accent)">–ö—É—Ä—Å –±–∞“ì–¥–∞—Ä–ª–∞–º–∞—Å—ã —Ç“Ø–∑—ñ–ª—É–¥–µ...</div>
    <div style="font-size:12px; color:var(--text-sec); margin-top:5px;">”ò–ª—Å—ñ–∑ —Ç–∞“õ—ã—Ä—ã–ø—Ç–∞—Ä —Å–∞—Ä–∞–ø—Ç–∞–ª—É–¥–∞</div>
  </div>

  <script>
    // 1. UPDATED DATA with 'topic'
    const questions = [
      {
        q: "–î–µ–Ω–µ 20 –º/—Å –∂—ã–ª–¥–∞–º–¥—ã“õ–ø–µ–Ω —Ç—ñ–∫ –∂–æ“ì–∞—Ä—ã –ª–∞“õ—Ç—ã—Ä—ã–ª–¥—ã. –ï“£ –∂–æ“ì–∞—Ä—ã –±–∏—ñ–∫—Ç—ñ–≥—ñ? (g = 10 –º/—Å¬≤)",
        options: ["10 –º", "15 –º", "20 –º", "25 –º", "40 –º"],
        correct: 2,
        topic: "–ö–∏–Ω–µ–º–∞—Ç–∏–∫–∞"
      },
      {
        q: "–ò–¥–µ–∞–ª –≥–∞–∑–¥—ã“£ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞—Å—ã 3 –µ—Å–µ –∞—Ä—Ç—Å–∞, –∫–∏–Ω–µ—Ç–∏–∫–∞–ª—ã“õ —ç–Ω–µ—Ä–≥–∏—è “õ–∞–ª–∞–π ”©–∑–≥–µ—Ä–µ–¥—ñ?",
        options: ["3 –µ—Å–µ –∫–µ–º–∏–¥—ñ", "”®–∑–≥–µ—Ä–º–µ–π–¥—ñ", "9 –µ—Å–µ –∞—Ä—Ç–∞–¥—ã", "3 –µ—Å–µ –∞—Ä—Ç–∞–¥—ã", "‚àö3 –µ—Å–µ –∞—Ä—Ç–∞–¥—ã"],
        correct: 3,
        topic: "–ú–æ–ª–µ–∫—É–ª–∞–ª—ã“õ —Ñ–∏–∑–∏–∫–∞"
      },
      {
        q: "–ö–µ—Ä–Ω–µ—É 220 –í, —Ç–æ–∫ 5 –ê –±–æ–ª—Å–∞, “õ—É–∞—Ç “õ–∞–Ω–¥–∞–π?",
        options: ["44 –í—Ç", "110 –í—Ç", "1100 –í—Ç", "880 –í—Ç", "225 –í—Ç"],
        correct: 2,
        topic: "–¢“±—Ä–∞“õ—Ç—ã —Ç–æ–∫"
      },
      {
        q: "–°–µ—Ä—ñ–ø–ø–µ–ª—ñ –º–∞—è—Ç–Ω–∏–∫—Ç—ñ“£ –ø–µ—Ä–∏–æ–¥—ã–Ω—ã“£ —Ñ–æ—Ä–º—É–ª–∞—Å—ã:",
        options: ["T = 2œÄ‚àö(l/g)", "T = 2œÄ‚àö(m/k)", "T = 2œÄ‚àö(k/m)", "T = 1/2œÄ‚àö(LC)", "T = mg"],
        correct: 1,
        topic: "–¢–µ—Ä–±–µ–ª—ñ—Å—Ç–µ—Ä"
      },
      {
        q: "–ñ–∞—Ä—ã“õ—Ç—ã“£ –≤–∞–∫—É—É–º–¥–µ–≥—ñ –∂—ã–ª–¥–∞–º–¥—ã“ì—ã:",
        options: ["300 000 –∫–º/—Å", "330 –º/—Å", "3000 –∫–º/—Å", "30 000 –∫–º/—Å", "—à–µ–∫—Å—ñ–∑–¥—ñ–∫"],
        correct: 0,
        topic: "–û–ø—Ç–∏–∫–∞"
      },
      {
        q: "–ò–∑–æ—Ö–æ—Ä–∞–ª—ã“õ –ø—Ä–æ—Ü–µ—Å—Ç–µ —Ç“±—Ä–∞“õ—Ç—ã —à–∞–º–∞:",
        options: ["–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (T)", "“ö—ã—Å—ã–º (P)", "–ö”©–ª–µ–º (V)", "–ñ—ã–ª—É (Q)", "–≠–Ω—Ç—Ä–æ–ø–∏—è"],
        correct: 2,
        topic: "–¢–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏–∫–∞"
      },
      {
        q: "–ú–∞—Å—Å–∞—Å—ã 2 –∫–≥ –¥–µ–Ω–µ–≥–µ 10 –ù –∫“Ø—à ”ô—Å–µ—Ä –µ—Ç—Å–µ, “Ø–¥–µ—É—ñ:",
        options: ["0.2 –º/—Å¬≤", "20 –º/—Å¬≤", "5 –º/—Å¬≤", "8 –º/—Å¬≤", "50 –º/—Å¬≤"],
        correct: 2,
        topic: "–î–∏–Ω–∞–º–∏–∫–∞"
      },
      {
        q: "–û–ø—Ç–∏–∫–∞–ª—ã“õ –∫“Ø—à—Ç—ñ“£ ”©–ª—à–µ–º –±—ñ—Ä–ª—ñ–≥—ñ:",
        options: ["–ú–µ—Ç—Ä", "–î–∂–æ—É–ª—å", "–ù—å—é—Ç–æ–Ω", "–î–∏–æ–ø—Ç—Ä–∏—è", "–í–∞—Ç—Ç"],
        correct: 3,
        topic: "–û–ø—Ç–∏–∫–∞"
      },
      {
        q: "–Ø–¥—Ä–æ–ª—ã“õ —Ä–µ–∞–∫—Ç–æ—Ä–¥–∞ –±–∞—è—É–ª–∞—Ç“õ—ã—à —Ä–µ—Ç—ñ–Ω–¥–µ “õ–æ–ª–¥–∞–Ω—ã–ª–∞–¥—ã:",
        options: ["–ö–∞–¥–º–∏–π", "–ì—Ä–∞—Ñ–∏—Ç / –ê—É—ã—Ä —Å—É", "–£—Ä–∞–Ω", "“ö–æ—Ä“ì–∞—Å—ã–Ω", "–ë–µ—Ç–æ–Ω"],
        correct: 1,
        topic: "–Ø–¥—Ä–æ–ª—ã“õ —Ñ–∏–∑–∏–∫–∞"
      },
      {
        q: "–ê–º–ø–µ—Ä –∫“Ø—à—ñ–Ω—ñ“£ –±–∞“ì—ã—Ç—ã–Ω –∞–Ω—ã“õ—Ç–∞–π—Ç—ã–Ω –µ—Ä–µ–∂–µ:",
        options: ["–ë“±—Ä“ì—ã", "–û“£ “õ–æ–ª", "–°–æ–ª “õ–æ–ª", "–õ–µ–Ω—Ü", "–ö—É–ª–æ–Ω"],
        correct: 2,
        topic: "–ú–∞–≥–Ω–µ—Ç–∏–∑–º"
      }
    ];

    let currentQIndex = 0;
    let score = 0;

    // 2. ANALYTICS STATE
    let topicStats = {}; // { "TopicName": { total: 0, wrong: 0 } }

    const quizUI = document.getElementById('quizUI');
    const resultUI = document.getElementById('resultUI');
    const questionText = document.getElementById('questionText');
    const topicTag = document.getElementById('topicTag');
    const optionsGrid = document.getElementById('optionsGrid');
    const currQSpan = document.getElementById('currQ');
    const scoreValSpan = document.getElementById('scoreVal');
    const analysisBlock = document.getElementById('analysisBlock');
    const weakList = document.getElementById('weakList');

    function initGame() {
      currentQIndex = 0;
      score = 0;
      topicStats = {};
      scoreValSpan.innerText = "0";
      loadQuestion();
    }

    function loadQuestion() {
      if (currentQIndex >= questions.length) {
        endGame();
        return;
      }

      const qData = questions[currentQIndex];
      questionText.innerHTML = qData.q;
      topicTag.innerText = qData.topic;
      currQSpan.innerText = currentQIndex + 1;

      // Initialize stats if new topic
      if (!topicStats[qData.topic]) {
        topicStats[qData.topic] = { total: 0, wrong: 0 };
      }

      optionsGrid.innerHTML = '';

      // Animation reset
      questionText.style.animation = 'none';
      questionText.offsetHeight;
      questionText.style.animation = 'fadeUp 0.4s ease-out';

      qData.options.forEach((opt, idx) => {
        const btn = document.createElement('div');
        btn.className = 'option-btn';
        const letter = String.fromCharCode(65 + idx);
        btn.innerHTML = `<div class="opt-letter">${letter}</div><span>${opt}</span>`;
        btn.onclick = () => checkAnswer(idx, btn);
        optionsGrid.appendChild(btn);
      });
    }

    function checkAnswer(selectedIndex, btnElement) {
      if (btnElement.classList.contains('disabled')) return;

      const qData = questions[currentQIndex];
      const buttons = optionsGrid.querySelectorAll('.option-btn');
      buttons.forEach(b => b.classList.add('disabled'));

      // Update Stats
      topicStats[qData.topic].total++;

      if (selectedIndex === qData.correct) {
        score += 100;
        scoreValSpan.innerText = score;

        // Feature: Add Coins
        try {
          const currentCoins = parseInt(localStorage.getItem('physx_coins') || "50");
          const newCoins = currentCoins + 10;
          localStorage.setItem('physx_coins', String(newCoins));
          showToast("–î“±—Ä—ã—Å! +100 XP & +10 ‚ö°", true);
        } catch (e) {
          showToast("–î“±—Ä—ã—Å! +100 XP", true);
        }

        btnElement.classList.add('correct-state');
      } else {
        showToast("“ö–∞—Ç–µ!", false);
        btnElement.classList.add('wrong-state');
        buttons[qData.correct].classList.add('correct-state');

        // Mark as wrong for analytics
        topicStats[qData.topic].wrong++;
      }

      setTimeout(() => {
        currentQIndex++;
        loadQuestion();
      }, 1500);
    }

    function endGame() {
      quizUI.style.display = 'none';
      resultUI.style.display = 'flex';

      document.getElementById('finalScore').innerText = score;
      const feedback = document.getElementById('feedbackText');

      if (score >= 900) feedback.innerText = "–ì—Ä–∞–Ω—Ç —Å–µ–Ω—ñ“£ “õ–æ–ª—ã“£–¥–∞! üèÜ";
      else if (score >= 600) feedback.innerText = "–ñ–∞“õ—Å—ã –Ω”ô—Ç–∏–∂–µ, –±—ñ—Ä–∞“õ –∂–µ—Ç—ñ–ª–¥—ñ—Ä—É “õ–∞–∂–µ—Ç üí™";
      else feedback.innerText = "–ö”©–±—ñ—Ä–µ–∫ –¥–∞–π—ã–Ω–¥–∞–ª–∞–π—ã“õ üìö";

      // 3. GENERATE ANALYSIS
      generateAnalysis();
    }

    function generateAnalysis() {
      weakList.innerHTML = '';
      let hasWeakness = false;

      // Convert object to array and sort by wrong count
      const sortedTopics = Object.keys(topicStats).map(key => {
        return { name: key, ...topicStats[key] };
      }).filter(t => t.wrong > 0); // Only show topics with mistakes

      if (sortedTopics.length > 0) {
        analysisBlock.style.display = 'block';
        sortedTopics.forEach(t => {
          const div = document.createElement('div');
          div.className = 'weak-item';
          div.innerHTML = `
                <div class="w-name">${t.name}</div>
                <div class="w-val">${t.wrong} “õ–∞—Ç–µ</div>
              `;
          weakList.appendChild(div);
        });
      } else {
        analysisBlock.style.display = 'none';
      }
    }

    // 4. PERSONAL COURSE SIMULATION
    function generatePersonalCourse() {
      const loader = document.getElementById('courseLoader');
      const btn = document.querySelector('.btn-ai');

      // UX Feedback
      loader.style.display = 'flex';

      // Simulate API call / Processing time
      setTimeout(() => {
        loader.style.display = 'none';

        // Identify weakest topic
        const topics = Object.keys(topicStats);
        let weakest = topics[0];
        let maxWrong = -1;

        topics.forEach(t => {
          if (topicStats[t].wrong > maxWrong) {
            maxWrong = topicStats[t].wrong;
            weakest = t;
          }
        });

        if (maxWrong === 0) weakest = "–ë–∞—Ä–ª—ã“ì—ã"; // Perfect score case

        // Topic Mapping
        const topicMap = {
          "–ö–∏–Ω–µ–º–∞—Ç–∏–∫–∞": "kinematics",
          "–î–∏–Ω–∞–º–∏–∫–∞": "mechanics",
          "–¢–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏–∫–∞": "thermo",
          "–ú–æ–ª–µ–∫—É–ª–∞–ª—ã“õ —Ñ–∏–∑–∏–∫–∞": "thermo",
          "–¢“±—Ä–∞“õ—Ç—ã —Ç–æ–∫": "electricity",
          "–ú–∞–≥–Ω–µ—Ç–∏–∑–º": "electrodynamics",
          "–û–ø—Ç–∏–∫–∞": "optics",
          "–Ø–¥—Ä–æ–ª—ã“õ —Ñ–∏–∑–∏–∫–∞": "quantum",
          "–¢–µ—Ä–±–µ–ª—ñ—Å—Ç–µ—Ä": "oscillations"
        };

        const linkedId = topicMap[weakest] || "mechanics";

        // Save plan to localStorage
        const plan = {
          id: `personal-${Date.now()}`,
          title: `–ñ–µ–∫–µ –∂–æ—Å–ø–∞—Ä: ${weakest}`,
          topic: "AI “∞—Å—ã–Ω—ã—Å—ã (“∞–ë–¢ –Ω”ô—Ç–∏–∂–µ—Å—ñ)",
          level: "11-—Å—ã–Ω—ã–ø", // Assuming ENT taker is 11th grade
          progress: 0,
          linkedTopic: linkedId
        };

        let personalPlans = JSON.parse(localStorage.getItem('physx_personal_plans') || "[]");
        personalPlans.unshift(plan);
        localStorage.setItem('physx_personal_plans', JSON.stringify(personalPlans));

        // Redirect to profile tab
        localStorage.setItem('physx_active_tab', 'profile');
        showToast("–ñ–µ–∫–µ –∂–æ—Å–ø–∞—Ä “õ“±—Ä—ã–ª–¥—ã!", true);

        setTimeout(() => {
          window.location.href = "home.html";
        }, 1000);
      }, 2000);
    }

    function showToast(msg, isSuccess) {
      const t = document.getElementById('toast');
      const icon = isSuccess
        ? '<polyline points="20 6 9 17 4 12"></polyline>'
        : '<line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>';

      t.querySelector('svg').innerHTML = icon;
      t.querySelector('span').innerText = msg;
      t.style.borderColor = isSuccess ? 'var(--success)' : 'var(--danger)';
      t.style.color = isSuccess ? 'var(--success)' : 'var(--danger)';
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 1500);
    }

    initGame();
  </script>

</body>

</html>