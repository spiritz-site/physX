<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Загрузка... | Jumys.online</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <meta name="description" content="Поиск работы и сотрудников в Кызылорде.">
  <meta property="og:title" content="Jumys.online">
  <meta property="og:description" content="Find work or employees in 5 minutes.">
  <meta property="og:image" content="https://raw.githubusercontent.com/spiritz-site/Jumys.online/main/poster%2016%209.png">
  <meta property="og:type" content="website">
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/spiritz-site/Jumys.online/main/favicon.png">

  <style>
    /* ===== BASE & RESET ===== */
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { height: 100%; margin: 0; }
    
    body { 
      font-family: 'Montserrat', sans-serif; 
      color: #172343; 
      background-color: #F3F4F6;
      overflow-y: auto; 
    }

    /* ===== UI COMPONENTS ===== */
    .nav-overlay {
      position: fixed; top: 0; left: 0; right: 0;
      padding: 16px 20px;
      display: flex; justify-content: space-between;
      z-index: 100; pointer-events: none;
    }
    .circle-btn {
      width: 44px; height: 44px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0,0,0,0.08);
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; pointer-events: auto;
      color: #172343; transition: all 0.2s;
    }
    .circle-btn:active { transform: scale(0.92); }
    .circle-btn:hover { background: #fff; box-shadow: 0 6px 20px rgba(0,0,0,0.12); }

    .app { 
      max-width: 600px;
      margin: 0 auto;
      background: #fff;
      min-height: 100vh;
      box-shadow: 0 0 40px rgba(0,0,0,0.05);
      padding-bottom: 80px;
      display: flex; flex-direction: column;
    }

    /* Gallery */
    .gallery-container {
      position: relative; width: 100%; height: 300px;
      background: #f1f5f9; overflow: hidden; flex-shrink: 0;
    }
    .gallery-scroll {
      display: flex; width: 100%; height: 100%;
      overflow-x: auto; scroll-snap-type: x mandatory;
      scrollbar-width: none;
    }
    .gallery-scroll::-webkit-scrollbar { display: none; }
    .gallery-item {
      flex: 0 0 100%; width: 100%; height: 100%;
      scroll-snap-align: start; object-fit: cover;
    }

    /* Card Body */
    .card-body {
      padding: 24px 20px;
      background: #fff;
      border-radius: 24px 24px 0 0;
      margin-top: -24px;
      position: relative;
      z-index: 10;
      flex-grow: 1;
    }
    .card-body.no-hero {
      margin-top: 0; border-radius: 0; padding-top: 80px;
    }

    /* PFP (Avatar) */
    .pfp-container {
      width: 100px; height: 100px;
      border-radius: 50%;
      border: 4px solid #fff;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      background: #fff;
      margin-top: -60px;
      margin-bottom: 16px;
      position: relative; z-index: 20;
      overflow: hidden;
    }
    .pfp-img { width: 100%; height: 100%; object-fit: cover; }

    /* Headers */
    .place-header { margin-bottom: 16px; }
    .place-title { font-size: 28px; font-weight: 800; line-height: 1.15; margin-bottom: 6px; color: #0F172A; }
    .place-category { font-size: 15px; font-weight: 500; color: #64748b; }

    /* Tags */
    .tags-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; margin-bottom: 20px; }
    .tag-chip { padding: 6px 14px; border-radius: 8px; font-size: 13px; font-weight: 600; white-space: nowrap; }
    .tag-gray { background: #F1F5F9; color: #475569; }
    .tag-green { background: #DCFCE7; color: #166534; }
    .tag-blue { background: #DBEAFE; color: #1E40AF; }
    .tag-purple { background: #F3E8FF; color: #6B21A8; }
    .tag-orange { background: #FFEDD5; color: #9A3412; }
    .tag-cyan { background: #CFFAFE; color: #155E75; }
    .tag-pink { background: #ffebeb; color: #8f0000; }
    .tag-yellow { background: #fff9e5; color: #b38a00; }

    /* Hashtags */
    .hashtags-block { margin-top: 16px; display: flex; flex-wrap: wrap; gap: 8px; }
    .hashtag-link { color: #00205b; font-weight: 600; font-size: 14px; text-decoration: none; opacity: 0.85; transition: opacity 0.2s; }
    .hashtag-link:hover { opacity: 1; text-decoration: underline; }

    /* Rating */
    .rating-row { display: flex; align-items: center; gap: 8px; margin-bottom: 24px; padding-bottom: 20px; border-bottom: 1px solid #f1f5f9; }
    .stars-svg { display: flex; gap: 2px; color: #FFC107; }
    .rating-val { font-weight: 800; font-size: 16px; color: #172343; }
    .btn-2gis-small { margin-left: auto; background: rgba(108, 204, 51, 0.1); color: #5CB829; padding: 8px 14px; border-radius: 99px; font-size: 12px; font-weight: 700; text-decoration: none; display: flex; align-items: center; gap: 6px; }

    /* Actions */
    .actions-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 32px; }
    .action-big-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 74px; border-radius: 18px; text-decoration: none; font-weight: 600; font-size: 14px; transition: transform 0.1s; }
    .action-big-btn:active { transform: scale(0.98); }
    .btn-call { background: #EFF6FF; color: #1E40AF; }
    .btn-wa { background: #F0FDF4; color: #15803D; }

    /* Info List */
    .section-label { font-size: 18px; font-weight: 800; color: #0F172A; margin-bottom: 16px; }
    .info-list { display: flex; flex-direction: column; }
    .info-row { display: flex; align-items: center; gap: 16px; padding: 18px 0; border-bottom: 1px solid #f1f5f9; text-decoration: none; color: inherit; transition: background 0.2s; }
    .info-row:hover { background: #fcfcfc; }
    .info-icon { width: 40px; height: 40px; flex-shrink: 0; border-radius: 12px; background: #F8FAFC; display: flex; align-items: center; justify-content: center; color: #64748b; }
    .info-content { flex: 1; }
    .info-title { font-size: 15px; font-weight: 600; color: #1E293B; line-height: 1.35; }
    .info-subtitle { font-size: 13px; color: #94A3B8; margin-top: 3px; }
    .salary-row .info-icon { background: #DCFCE7; color: #15803D; }
    .salary-row .info-title { color: #15803D; font-weight: 800; font-size: 18px; }

    .desc-content { color: #334155; font-size: 16px; line-height: 1.8; }
    .desc-content p { margin-bottom: 16px; }

    /* Skeleton & Modal */
    .skeleton-box { background: linear-gradient(110deg, #ececec 8%, #f5f5f5 18%, #ececec 33%); background-size: 200% 100%; animation: shine 1.5s linear infinite; border-radius: 8px; }
    @keyframes shine { to { background-position-x: -200%; } }
    .hidden { display: none !important; }
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; z-index: 2000; opacity: 0; visibility: hidden; transition: 0.3s; }
    .modal-overlay.active { opacity: 1; visibility: visible; }
    .modal-card { background: #fff; padding: 24px; border-radius: 20px; width: 80%; max-width: 320px; text-align: center; }

    /* Desktop View */
    @media (min-width: 900px) {
      body { overflow: hidden; background: #fff; }
      .nav-overlay { position: fixed; top: 30px; right: 40px; left: auto; width: auto; gap: 12px; padding: 0; z-index: 200; }
      .app { width: 100vw; height: 100vh; max-width: none; margin: 0; flex-direction: row; }
      .gallery-container { width: 50%; height: 100%; border-right: 1px solid #e2e8f0; }
      .card-body { width: 50%; height: 100%; overflow-y: auto; padding: 60px 80px; border-radius: 0; margin-top: 0; }
      .pfp-container { width: 140px; height: 140px; margin-top: 0; margin-bottom: 32px; border: none; }
      .place-title { font-size: 36px; }
    }
  </style>
</head>
<body>

  <div class="nav-overlay">
    <div class="circle-btn" onclick="goBack()" style="margin-right: auto;">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
    </div>
    <div class="circle-btn" onclick="shareLink()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" y1="2" x2="12" y2="15"></line></svg>
    </div>
  </div>

  <div class="app">
    <div id="skeleton" style="width:100%; height:100%; display:flex; flex-direction:column;">
      <div class="skeleton-box" style="width: 100%; height: 300px; border-radius: 0; flex-shrink:0"></div>
      <div style="padding: 24px; flex-grow:1">
        <div class="skeleton-box" style="width: 70%; height: 32px; margin-bottom: 12px;"></div>
        <div class="skeleton-box" style="width: 100%; height: 200px;"></div>
      </div>
    </div>
    <div id="mainContent" class="hidden" style="display:contents"></div>
  </div>

  <div id="customAlert" class="modal-overlay" onclick="closeAlert()">
    <div class="modal-card" onclick="event.stopPropagation()">
      <h3 style="margin: 0 0 10px 0;">Уведомление</h3>
      <div id="modalMsg" style="margin-bottom: 20px; color: #64748b;"></div>
      <button onclick="closeAlert()" style="background: #00205b; color: #fff; border: none; padding: 12px 24px; border-radius: 12px; font-weight: 600; width: 100%;">OK</button>
    </div>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbyf9kKiLvAnazrc_3X3riq5QSDaex8Rcrtk_VwxPA6D6jNZCCNAR9O8ibCz9_K1ojPTVA/exec";
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id');
    const urlLang = urlParams.get('lang');
    const currentLang = (urlLang === "ru") ? "ru" : (localStorage.getItem("lang") === "ru" ? "ru" : "kz");
    const t = currentLang === "ru" ? { error: "Инфо не найдено", copied: "Ссылка скопирована", open2gis: "Открыть в 2GIS" } : { error: "Ақпарат табылмады", copied: "Сілтеме көшірілді", open2gis: "2GIS-тен ашу" };

    function goBack() { window.location.href = `home.html?lang=${currentLang}`; }
    function showAlert(m){ document.getElementById("modalMsg").textContent = m; document.getElementById("customAlert").classList.add("active"); }
    function closeAlert(){ document.getElementById("customAlert").classList.remove("active"); }
    function shareLink() { navigator.clipboard.writeText(window.location.href).then(() => showAlert(t.copied)); }

    // --- SEO LOGIC ---
    function updateSEO(item) {
      const siteName = "Jumys.online";
      const title = `${item.title} в ${item.subtitle || ''} — Кызылорда | ${siteName}`;
      const description = `${item.title} в Кызылорде. Зарплата: ${item.salary || 'Договорная'}. ${item.desc || ''}`;
      const image = getPhotos(item)[0] || "https://raw.githubusercontent.com/spiritz-site/Jumys.online/main/poster%2016%209.png";

      document.title = title;
      updateMeta("description", description, false);
      updateMeta("og:title", title, true);
      updateMeta("og:description", description, true);
      updateMeta("og:image", image, true);
      updateMeta("og:url", window.location.href, true);
    }

    function updateMeta(attr, content, isProperty) {
      const selector = isProperty ? `meta[property="${attr}"]` : `meta[name="${attr}"]`;
      let el = document.querySelector(selector);
      if (!el) {
        el = document.createElement('meta');
        if (isProperty) el.setAttribute('property', attr);
        else el.name = attr;
        document.head.appendChild(el);
      }
      el.content = content;
    }

    async function loadItem() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        const item = data.find(row => String(row.id) === String(id));
        document.getElementById("skeleton").classList.add("hidden");
        document.getElementById("mainContent").classList.remove("hidden");
        if (!item) { document.getElementById("mainContent").innerHTML = `<div style="text-align:center; padding:40px;">${t.error}</div>`; return; }
        renderPage(item);
      } catch (e) { console.error(e); }
    }

    function getTagClass(tone) {
      const map = { green: 'tag-green', blue: 'tag-blue', purple: 'tag-purple', orange: 'tag-orange', cyan: 'tag-cyan' , pink: 'tag-pink', yellow: 'tag-yellow' };
      return map[(tone||"").toLowerCase()] || 'tag-gray';
    }

    function renderStars(rating) {
      if (!rating) return '';
      const r = parseFloat(rating);
      let html = '';
      for (let i = 1; i <= 5; i++) {
        html += (r >= i) 
          ? `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>`
          : `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>`;
      }
      return html;
    }

    function getPhotos(item) {
      if (item.photos) return item.photos.split(',').map(s=>s.trim()).filter(s=>s);
      return [item.img1, item.img2, item.img3].filter(Boolean);
    }

    function renderInfoRow(icon, title, subtitle, link, isExternal = false) {
      return `
        <a href="${link}" ${isExternal ? 'target="_blank"' : ''} class="info-row">
          <div class="info-icon">${icon}</div>
          <div class="info-content">
            <div class="info-title">${title}</div>
            ${subtitle ? `<div class="info-subtitle">${subtitle}</div>` : ''}
          </div>
          <div class="arrow-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg></div>
        </a>`;
    }

    function formatDescription(text) {
      if (!text) return '';
      return text.split(/\n+/).filter(p => p.trim().length > 0).map(p => `<p>${p}</p>`).join('');
    }

    function renderPage(item) {
      updateSEO(item);
      const photos = getPhotos(item);
      const galleryHtml = photos.length ? `
        <div class="gallery-container">
          <div class="gallery-scroll">
            ${photos.map(src => `<img src="${src}" class="gallery-item" alt="photo">`).join('')}
          </div>
        </div>` : '<div class="gallery-container" style="background:#f1f5f9; display:flex;align-items:center;justify-content:center;color:#ccc"><svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg></div>';

      let pfpHtml = item.pfp ? `<div class="pfp-container"><img src="${item.pfp}" class="pfp-img" alt="Avatar"></div>` : '';

      let tagsHtml = '';
      const tagsList = [];
      if (item.tag1) tagsList.push({ text: item.tag1, cls: getTagClass(item.tag1_tone) });
      if (item.tag2) tagsList.push({ text: item.tag2, cls: getTagClass(item.tag2_tone) });
      if (item.tags) {
        item.tags.split(',').map(s => s.trim()).filter(s => s).forEach(t => tagsList.push({ text: t, cls: 'tag-gray' }));
      }
      if (tagsList.length > 0) tagsHtml = `<div class="tags-container">${tagsList.map(t => `<span class="tag-chip ${t.cls}">${t.text}</span>`).join('')}</div>`;

      let hashtagsHtml = '';
      if (item.hashtags) {
        hashtagsHtml = `<div class="hashtags-block">${item.hashtags.split(',').map(s => s.trim()).filter(s => s).map(tag => `<span class="hashtag-link">#${tag.replace('#','')}</span>`).join('')}</div>`;
      }

      let ratingBlock = item.rating ? `
          <div class="rating-row">
            <div class="stars-svg">${renderStars(item.rating)}</div>
            <span class="rating-val">${item.rating}</span>
            ${item.twoGis ? `<a href="${item.twoGis}" target="_blank" class="btn-2gis-small"><span>${t.open2gis}</span><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a>` : ''}
          </div>` : '';

      const phone = item.phone || item.contact;
      const cleanWa = item.whatsapp ? item.whatsapp.replace(/\D/g,'') : null;
      let actionsGrid = (phone || cleanWa) ? `<div class="actions-grid">
        ${phone ? `<a href="tel:${phone}" class="action-big-btn btn-call"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-bottom:4px"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg><span>Позвонить</span></a>` : ''}
        ${cleanWa ? `<a href="https://wa.me/${cleanWa}" target="_blank" class="action-big-btn btn-wa"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-bottom:4px"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg><span>WhatsApp</span></a>` : ''}
      </div>` : '';

      let infoRows = '';
      if (item.salary || item.price) infoRows += `<div class="info-row salary-row"><div class="info-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg></div><div class="info-content"><div class="info-title">${item.salary || item.price}</div><div class="info-subtitle">Зарплата / Цена</div></div></div>`;
      if (item.address) infoRows += `<div class="info-row"><div class="info-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg></div><div class="info-content"><div class="info-title">${item.address}</div><div class="info-subtitle">Адрес</div></div></div>`;
      if (item.hours) infoRows += `<div class="info-row"><div class="info-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg></div><div class="info-content"><div class="info-title">${item.hours}</div><div class="info-subtitle">График</div></div></div>`;
      if (item.instagram) infoRows += renderInfoRow(`<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#C13584" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>`, "Instagram", "Открыть профиль", item.instagram, true);

      const descHtml = (item.desc_full || item.desc)
        ? `<div class="section-label" style="margin-top:32px">Инфо</div>
           <div class="desc-content">${formatDescription(item.desc_full || item.desc)}</div>
           ${hashtagsHtml}` 
        : '';

      document.getElementById("mainContent").innerHTML = `
        ${galleryHtml}
        <div class="card-body ${!photos.length ? 'no-hero' : ''}">
          ${pfpHtml}
          <div class="place-header">
            <div class="place-title">${item.title}</div>
            <div class="place-category">${item.category || item.subtitle || ''}</div>
          </div>
          ${tagsHtml}
          ${ratingBlock}
          ${actionsGrid}
          <div class="info-list">${infoRows}</div>
          ${descHtml}
        </div>`;
    }

    loadItem();
  </script>
</body>
</html>