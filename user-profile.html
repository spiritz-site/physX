<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Sheber.kz | Профиль</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    *:focus { outline: none !important; }
    * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
    html, body { height: 100%; margin: 0; font-family: 'Montserrat', sans-serif; background: var(--bg-main); color: var(--text-main); overflow-x: hidden; }

    :root{
      --accent-green:#00f2a0;
      --accent-blue:#00c9ff;
      --transition:0.3s cubic-bezier(0.25, 0.8, 0.25, 1);

      --bg-img-desktop: url('/images/background-desktop-1.png');
      --bg-img-mobile: url('/images/background-mobile-1.png');
    }

    [data-theme="dark"]{
      --bg-main:#010a1a;
      --bg-overlay: linear-gradient(to bottom, rgba(0, 0, 0, 0.55), rgba(0, 0, 0, 0.35), rgba(0, 0, 0, 0.75));
      --text-main:#fff;
      --text-dim:rgba(255,255,255,0.62);
      --glass-bg:rgba(255,255,255,0.08);
      --glass-border:rgba(255,255,255,0.1);
      --card-bg: linear-gradient(145deg, rgba(255,255,255,0.07) 0%, rgba(255,255,255,0.03) 100%);
      --menu-bg:#0b1426;
      --sidebar-border:rgba(255,255,255,0.1);
      --switcher-bg:rgba(255,255,255,0.08);
      --switcher-active-bg:rgba(255,255,255,0.2);
      --switcher-active-text:#fff;
      --accent-gradient: linear-gradient(135deg, #00f2a0 0%, #00c9ff 100%);
      --accent-text-color:#010a1a;
      --danger:#ff4757;
    }

    [data-theme="light"]{
      --bg-img-desktop: url('/images/background-desktop-white-1.png');
      --bg-img-mobile: url('/images/background-mobile-white-1.png');
      --bg-main:#f0f4f8;
      --bg-overlay: linear-gradient(to bottom, rgba(255, 255, 255, 0.88), rgba(255, 255, 255, 0.75), rgba(255, 255, 255, 0.92));
      --text-main:#1a202c;
      --text-dim:#4a5568;
      --glass-bg:rgba(255,255,255,0.65);
      --glass-border:rgba(255,255,255,0.6);
      --card-bg: linear-gradient(145deg, rgba(255,255,255,0.92) 0%, rgba(255,255,255,0.6) 100%);
      --menu-bg:#fff;
      --sidebar-border:rgba(0,0,0,0.1);
      --switcher-bg:rgba(0,0,0,0.05);
      --switcher-active-bg:#fff;
      --switcher-active-text:#1a202c;
      --accent-gradient: linear-gradient(135deg, #00f2a0 0%, #00c9ff 100%);
      --accent-text-color:#010a1a;
      --danger:#e53e3e;
    }

    .app-container{
      min-height:100vh;
      position:relative;
      background-image:var(--bg-img-desktop);
      background-size:cover;
      background-position:center;
      background-attachment:fixed;
      transition: background-image .3s ease;
    }
    .app-container::before{
      content:""; position:absolute; inset:0;
      background: var(--bg-overlay);
      z-index:0; pointer-events:none;
    }
    @media (max-width:768px){
      .app-container{ background-image:var(--bg-img-mobile); background-attachment:scroll; }
    }

    .main{
      position:relative; z-index:2;
      max-width:600px;
      margin:0 auto;
      padding:16px 20px 140px 20px; /* место под bottom bar */
    }

    /* Header */
    .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 0 18px 0;
    }
    .icon-btn{
      width:44px; height:44px;
      border-radius:50%;
      background:var(--glass-bg);
      border:1px solid var(--glass-border);
      display:flex; align-items:center; justify-content:center;
      cursor:pointer;
      backdrop-filter: blur(10px);
      transition: transform .12s ease;
      user-select:none;
    }
    .icon-btn:active{ transform:scale(.96); }
    .icon-btn svg{ width:24px; height:24px; fill: var(--text-main); }

    .title{
      font-size:16px;
      font-weight:900;
      letter-spacing:.3px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .badge{
      font-size:10px;
      font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(0, 242, 160, 0.12);
      border: 1px solid rgba(0, 242, 160, 0.18);
      color: var(--text-main);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* Cards */
    .card{
      background: var(--card-bg);
      border: 1px solid var(--glass-border);
      border-radius: 24px;
      backdrop-filter: blur(12px);
      padding: 18px;
    }

    .profile-hero{
      display:flex;
      gap:14px;
      align-items:center;
      padding:18px;
      border-radius:26px;
      background: linear-gradient(145deg, rgba(0,242,160,0.12), rgba(0,201,255,0.08));
      border: 1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(12px);
      position: relative;
      overflow:hidden;
      margin-bottom:14px;
    }
    .profile-hero::after{
      content:"";
      position:absolute; inset:-40px;
      background: radial-gradient(circle at 20% 10%, rgba(0,242,160,0.18), transparent 45%),
                  radial-gradient(circle at 80% 0%, rgba(0,201,255,0.16), transparent 48%);
      pointer-events:none;
    }

    .avatar{
      width:62px; height:62px;
      border-radius:22px;
      background: var(--glass-bg);
      border: 2px solid rgba(0,242,160,0.6);
      display:flex; align-items:center; justify-content:center;
      font-weight:900;
      font-size:22px;
      color: var(--text-main);
      flex: 0 0 auto;
      position:relative;
      z-index:1;
    }

    .hero-info{ flex:1; min-width:0; position:relative; z-index:1; }
    .hero-name{
      font-size:18px;
      font-weight:900;
      margin:0 0 4px 0;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .hero-sub{
      display:flex; flex-wrap:wrap;
      gap:10px;
      align-items:center;
      color: var(--text-dim);
      font-size:12px;
      font-weight:700;
    }
    .pill{
      padding:8px 10px;
      border-radius:999px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.12);
      display:flex; align-items:center; gap:8px;
    }
    [data-theme="light"] .pill{
      background: rgba(0,0,0,0.03);
      border: 1px solid rgba(0,0,0,0.05);
    }
    .pill svg{ width:14px; height:14px; fill: var(--accent-green); }

    /* Stats */
    .stats{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      margin-bottom:14px;
    }
    .stat{
      background: var(--card-bg);
      border:1px solid var(--glass-border);
      border-radius:20px;
      padding:14px 12px;
      text-align:center;
      backdrop-filter: blur(12px);
    }
    .stat-num{
      font-size:18px;
      font-weight:900;
      line-height:1;
      margin-bottom:6px;
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .stat-label{
      font-size:11px;
      font-weight:800;
      color: var(--text-dim);
      letter-spacing:.4px;
      text-transform: uppercase;
    }

    /* Sections */
    .section-title{
      font-size:14px;
      font-weight:900;
      margin:16px 0 10px 0;
      color: var(--text-main);
      letter-spacing: .3px;
    }

    .form{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width:460px){
      .row{ grid-template-columns:1fr; }
    }

    .field{
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .label{
      font-size:11px;
      font-weight:900;
      letter-spacing:1px;
      text-transform: uppercase;
      color: var(--accent-green);
    }
    .input{
      width:100%;
      padding:14px 14px;
      border-radius:16px;
      border:1px solid var(--glass-border);
      background: rgba(0,0,0,0.22);
      color: var(--text-main);
      font-family:inherit;
      font-size:15px;
      transition: var(--transition);
    }
    [data-theme="light"] .input{
      background: rgba(255,255,255,0.55);
    }
    .input:focus{
      border-color: rgba(0,242,160,0.8);
      box-shadow: 0 0 0 4px rgba(0,242,160,0.12);
      background: rgba(0,242,160,0.05);
    }
    .hint{
      font-size:12px;
      color: var(--text-dim);
      line-height:1.4;
    }

    /* Buttons */
    .btn{
      border:none;
      cursor:pointer;
      border-radius:18px;
      padding:16px 14px;
      font-weight:900;
      text-transform: uppercase;
      letter-spacing:1px;
      transition: transform .15s ease, box-shadow .2s ease, opacity .2s ease;
      user-select:none;
    }
    .btn:active{ transform: scale(.98); }

    .btn-primary{
      background: var(--accent-gradient);
      color: var(--accent-text-color);
      box-shadow: 0 14px 30px rgba(0,242,160,0.22);
    }
    .btn-ghost{
      background: var(--glass-bg);
      border:1px solid var(--glass-border);
      color: var(--text-main);
      backdrop-filter: blur(12px);
    }
    .btn-danger{
      background: rgba(255,71,87,0.14);
      border:1px solid rgba(255,71,87,0.25);
      color: var(--text-main);
    }

    .actions{
      display:flex;
      gap:12px;
      margin-top:10px;
    }
    .actions .btn{ flex:1; }

    /* Settings quick items */
    .list{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .item{
      background: var(--card-bg);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 14px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease;
      backdrop-filter: blur(12px);
    }
    .item:active{ transform: scale(.99); }

    .item-left{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:0;
    }
    .item-ic{
      width:40px; height:40px;
      border-radius:16px;
      background: rgba(0,242,160,0.10);
      border: 1px solid rgba(0,242,160,0.16);
      display:flex;
      align-items:center;
      justify-content:center;
      flex: 0 0 auto;
    }
    .item-ic svg{ width:20px; height:20px; fill: var(--accent-green); }
    .item-txt{ min-width:0; }
    .item-title{
      font-size:13px;
      font-weight:900;
      margin:0;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .item-sub{
      font-size:12px;
      color: var(--text-dim);
      margin-top:2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .chev svg{ width:22px; height:22px; fill: var(--text-dim); }

    /* Bottom bar */
    .bottom-bar{
      position: fixed;
      left: 50%;
      bottom: 14px;
      transform: translateX(-50%);
      width: min(620px, calc(100% - 24px));
      z-index: 120;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border-radius: 24px;
      padding: 10px 12px;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      align-items: center;
      box-shadow: 0 18px 55px rgba(0,0,0,0.28);
    }
    .nav-item{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:6px;
      padding:8px 10px;
      border-radius:18px;
      cursor:pointer;
      user-select:none;
      transition:0.15s ease;
      color: var(--text-dim);
    }
    .nav-item:active{ transform: scale(.98); }
    .nav-item svg{ width:22px; height:22px; fill: currentColor; }
    .nav-label{ font-size:11px; font-weight:800; }
    .nav-item.active{
      color: var(--text-main);
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.08);
    }
    [data-theme="light"] .nav-item.active{
      background: rgba(0,0,0,0.04);
      border: 1px solid rgba(0,0,0,0.06);
    }
    .nav-create{ margin-top:-24px; padding:0; }
    .create-btn{
      width:62px; height:62px;
      border-radius:22px;
      border:none;
      cursor:pointer;
      background: var(--accent-gradient);
      color: var(--accent-text-color);
      display:flex; align-items:center; justify-content:center;
      box-shadow: 0 18px 35px rgba(0,242,160,0.28);
      transition: transform .15s ease;
    }
    .create-btn:active{ transform: scale(.96); }
    .create-btn svg{ width:28px; height:28px; fill: currentColor; }
    .create-label{ margin-top:8px; font-size:11px; font-weight:900; color: var(--text-main); }

    /* Toast (только для сохранения/ошибок) */
    .toast-wrap{
      position: fixed;
      left: 50%;
      bottom: 96px;
      transform: translateX(-50%);
      z-index: 200;
      display: flex;
      flex-direction: column;
      gap: 10px;
      pointer-events: none;
      padding: 0 12px;
      width: min(520px, 92%);
    }
    .toast {
      pointer-events: auto;
      background: rgba(0,0,0,0.55);
      border: 1px solid rgba(255,255,255,0.14);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      color: var(--text-main);
      border-radius: 16px;
      padding: 12px 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      box-shadow: 0 12px 35px rgba(0,0,0,0.35);
      opacity: 0;
      transform: translateY(12px);
      transition: 0.25s ease;
      font-size: 14px;
      line-height: 1.35;
    }
    [data-theme="light"] .toast{
      background: rgba(255,255,255,0.78);
      border: 1px solid rgba(0,0,0,0.08);
      color: #1a202c;
    }
    .toast.show { opacity: 1; transform: translateY(0); }
    .toast .left { display:flex; align-items:center; gap:10px; min-width:0; }
    .toast .dot {
      width:10px; height:10px; border-radius:50%;
      background: var(--accent-blue);
      box-shadow: 0 0 0 4px rgba(0,201,255,0.12);
      flex: 0 0 auto;
    }
    .toast.success .dot { background: var(--accent-green); box-shadow: 0 0 0 4px rgba(0,242,160,0.12); }
    .toast.warn .dot { background: #ffcc00; box-shadow: 0 0 0 4px rgba(255,204,0,0.14); }
    .toast .msg { overflow:hidden; text-overflow:ellipsis; white-space:nowrap; font-weight:800; }
    .toast .close { background: transparent; border:none; color: inherit; cursor:pointer; font-size:18px; line-height:1; opacity:0.85; padding:0 4px; }
    .toast .close:hover { opacity:1; }

    /* Modal (UX: подтверждение выхода) */
    .modal-overlay{
      position: fixed; inset:0;
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(8px);
      z-index: 300;
      display:flex;
      align-items:center;
      justify-content:center;
      opacity:0; visibility:hidden;
      transition: .25s ease;
      padding: 18px;
    }
    .modal-overlay.active{ opacity:1; visibility:visible; }
    .modal{
      width: min(520px, 96%);
      background: var(--card-bg);
      border: 1px solid var(--glass-border);
      border-radius: 26px;
      padding: 18px;
      backdrop-filter: blur(14px);
      box-shadow: 0 26px 70px rgba(0,0,0,0.42);
    }
    .modal-title{
      font-size:16px;
      font-weight:900;
      margin: 0 0 6px 0;
    }
    .modal-desc{
      font-size:13px;
      color: var(--text-dim);
      margin:0 0 14px 0;
      line-height:1.45;
    }
    .modal-actions{ display:flex; gap:10px; }
    .modal-actions .btn{ flex:1; }

    /* UX: Save indicator in header */
    .save-indicator{
      font-size:12px;
      font-weight:800;
      color: var(--text-dim);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .save-dot{
      width:8px; height:8px; border-radius:50%;
      background: rgba(255,204,0,0.85);
      box-shadow: 0 0 0 4px rgba(255,204,0,0.12);
    }
    .save-dot.saved{
      background: rgba(0,242,160,0.9);
      box-shadow: 0 0 0 4px rgba(0,242,160,0.12);
    }
  </style>
</head>

<body>
  <div class="app-container">
    <div class="main">

      <header class="header">
        <button class="icon-btn" onclick="goBack()">
          <svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
        </button>

        <div class="title">
          <span data-i18n="profile_title">Профиль</span>
          <span class="badge" id="roleBadge">Client</span>
        </div>

        <div class="save-indicator" id="saveIndicator" title="Статус">
          <span class="save-dot" id="saveDot"></span>
          <span id="saveText" data-i18n="unsaved">Не сохранено</span>
        </div>
      </header>

      <!-- HERO -->
      <div class="profile-hero">
        <div class="avatar" id="avatarLetter">A</div>
        <div class="hero-info">
          <div class="hero-name" id="heroName">Азамат</div>
          <div class="hero-sub">
            <div class="pill" title="Телефон">
              <svg viewBox="0 0 24 24"><path d="M6.62 10.79a15.05 15.05 0 006.59 6.59l2.2-2.2a1 1 0 011.02-.24c1.12.37 2.33.57 3.57.57a1 1 0 011 1V20a1 1 0 01-1 1C10.07 21 3 13.93 3 5a1 1 0 011-1h3.5a1 1 0 011 1c0 1.24.2 2.45.57 3.57a1 1 0 01-.24 1.02l-2.21 2.2z"/></svg>
              <span id="heroPhone">+7 (707) 123-45-67</span>
            </div>
            <div class="pill" title="Город">
              <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 6.5 12 6.5s2.5 1.12 2.5 2.5S13.38 11.5 12 11.5z"/></svg>
              <span id="heroCity">Астана</span>
            </div>
          </div>
        </div>
      </div>

      <!-- STATS -->
      <div class="stats">
        <div class="stat">
          <div class="stat-num" id="statOrders">12</div>
          <div class="stat-label" data-i18n="stat_orders">Заказов</div>
        </div>
        <div class="stat">
          <div class="stat-num" id="statRating">4.9</div>
          <div class="stat-label" data-i18n="stat_rating">Рейтинг</div>
        </div>
        <div class="stat">
          <div class="stat-num" id="statSaved">0</div>
          <div class="stat-label" data-i18n="stat_saved">Сохранено</div>
        </div>
      </div>

      <!-- EDIT FORM -->
      <div class="section-title" data-i18n="edit_title">Данные профиля</div>
      <div class="card">
        <div class="form">
          <div class="row">
            <div class="field">
              <div class="label" data-i18n="lbl_name">Имя</div>
              <input class="input" id="nameInput" type="text" placeholder=" " autocomplete="name">
            </div>
            <div class="field">
              <div class="label" data-i18n="lbl_role">Роль</div>
              <select class="input" id="roleSelect">
                <option value="client" data-i18n="role_client">Заказчик</option>
                <option value="master" data-i18n="role_master">Мастер</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="field">
              <div class="label" data-i18n="lbl_phone">Телефон</div>
              <input class="input" id="phoneInput" type="tel" placeholder="+7 (700) 000-00-00" autocomplete="tel">
              <div class="hint" data-i18n="phone_hint">Номер используется для входа и уведомлений.</div>
            </div>
            <div class="field">
              <div class="label" data-i18n="lbl_city">Город</div>
              <input class="input" id="cityInput" type="text" placeholder=" " autocomplete="address-level2">
              <div class="hint" data-i18n="city_hint">Помогает показывать мастеров рядом.</div>
            </div>
          </div>

          <div class="field" id="masterFields" style="display:none;">
            <div class="label" data-i18n="lbl_spec">Специальность</div>
            <select class="input" id="specSelect">
              <option value="electrician" data-i18n="spec_electrician">Электрик</option>
              <option value="plumber" data-i18n="spec_plumber">Сантехник</option>
              <option value="builder" data-i18n="spec_builder">Ремонт</option>
              <option value="cleaner" data-i18n="spec_cleaner">Уборка</option>
            </select>
          </div>

          <div class="actions">
            <button class="btn btn-ghost" onclick="resetForm()" data-i18n="btn_cancel">Отмена</button>
            <button class="btn btn-primary" id="saveBtn" onclick="saveProfile()" data-i18n="btn_save">Сохранить</button>
          </div>
        </div>
      </div>

      <!-- QUICK SETTINGS -->
      <div class="section-title" data-i18n="settings_title">Быстрые настройки</div>
      <div class="list">
        <div class="item" onclick="toggleTheme()">
          <div class="item-left">
            <div class="item-ic">
              <svg viewBox="0 0 24 24"><path d="M9.37 5.51A7 7 0 0016.5 18.63 9 9 0 119.37 5.51z"/></svg>
            </div>
            <div class="item-txt">
              <div class="item-title" data-i18n="theme_title">Тема</div>
              <div class="item-sub" id="themeSub" data-i18n="theme_sub">Нажми, чтобы переключить</div>
            </div>
          </div>
          <div class="chev"><svg viewBox="0 0 24 24"><path d="M10 17l5-5-5-5v10z"/></svg></div>
        </div>

        <div class="item" onclick="openLangPicker()">
          <div class="item-left">
            <div class="item-ic">
              <svg viewBox="0 0 24 24"><path d="M12 3l4 8h-8l4-8zm-7 18l3-7h8l3 7H5z"/></svg>
            </div>
            <div class="item-txt">
              <div class="item-title" data-i18n="lang_title">Язык</div>
              <div class="item-sub" id="langSub">Қазақша / Русский</div>
            </div>
          </div>
          <div class="chev"><svg viewBox="0 0 24 24"><path d="M10 17l5-5-5-5v10z"/></svg></div>
        </div>

        <div class="item" onclick="openLogoutModal()">
          <div class="item-left">
            <div class="item-ic" style="background: rgba(255,71,87,0.10); border-color: rgba(255,71,87,0.16);">
              <svg viewBox="0 0 24 24" style="fill: var(--danger);"><path d="M10.09 15.59L11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67l-2.58 2.59zM20 3h-8c-1.1 0-2 .9-2 2v4h2V5h8v14h-8v-4h-2v4c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/></svg>
            </div>
            <div class="item-txt">
              <div class="item-title" data-i18n="logout_title">Выйти</div>
              <div class="item-sub" data-i18n="logout_sub">Завершить текущую сессию</div>
            </div>
          </div>
          <div class="chev"><svg viewBox="0 0 24 24"><path d="M10 17l5-5-5-5v10z"/></svg></div>
        </div>
      </div>

    </div>

    <!-- TOAST -->
    <div class="toast-wrap" id="toastWrap" aria-live="polite" aria-atomic="true"></div>

    <!-- LOGOUT MODAL -->
    <div class="modal-overlay" id="logoutModal" onclick="if(event.target.id==='logoutModal') closeLogoutModal()">
      <div class="modal">
        <div class="modal-title" data-i18n="logout_confirm_title">Выйти из аккаунта?</div>
        <div class="modal-desc" data-i18n="logout_confirm_desc">Ты сможешь снова войти по номеру телефона.</div>
        <div class="modal-actions">
          <button class="btn btn-ghost" onclick="closeLogoutModal()" data-i18n="btn_cancel">Отмена</button>
          <button class="btn btn-danger" onclick="logout()" data-i18n="btn_logout">Выйти</button>
        </div>
      </div>
    </div>

    <!-- BOTTOM BAR -->
    <nav class="bottom-bar">
      <div class="nav-item" onclick="goHome()">
        <svg viewBox="0 0 24 24"><path d="M12 3l9 8h-3v10h-5v-6H11v6H6V11H3l9-8z"/></svg>
        <div class="nav-label" data-i18n="tab_home">Главная</div>
      </div>

      <div class="nav-item nav-create" onclick="goCreate()">
        <button class="create-btn" aria-label="create">
          <svg viewBox="0 0 24 24"><path d="M19 11H13V5h-2v6H5v2h6v6h2v-6h6z"/></svg>
        </button>
        <div class="create-label" data-i18n="tab_create">Создать</div>
      </div>

      <div class="nav-item active">
        <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
        <div class="nav-label" data-i18n="tab_profile">Профиль</div>
      </div>
    </nav>

  </div>

  <script>
    const translations = {
      kz: {
        profile_title: "Профиль",
        unsaved: "Сақталмаған",
        saved: "Сақталды",
        edit_title: "Профиль деректері",
        settings_title: "Жылдам баптаулар",

        lbl_name: "Есім",
        lbl_role: "Рөл",
        lbl_phone: "Телефон",
        lbl_city: "Қала",
        lbl_spec: "Мамандық",

        phone_hint: "Нөмір кіру және хабарлама үшін керек.",
        city_hint: "Жақын шеберлерді көрсетуге көмектеседі.",

        role_client: "Тапсырыс беруші",
        role_master: "Шебер",

        spec_electrician: "Электрик",
        spec_plumber: "Сантехник",
        spec_builder: "Жөндеу",
        spec_cleaner: "Тазалық",

        btn_cancel: "Бас тарту",
        btn_save: "Сақтау",

        theme_title: "Тақырып",
        theme_sub: "Ауыстыру үшін түртіңіз",
        lang_title: "Тіл",

        logout_title: "Шығу",
        logout_sub: "Сессияны аяқтау",
        logout_confirm_title: "Аккаунттан шығу?",
        logout_confirm_desc: "Телефон арқылы қайта кіре аласыз.",
        btn_logout: "Шығу",

        stat_orders: "Тапсырыс",
        stat_rating: "Рейтинг",
        stat_saved: "Сақтау",

        tab_home: "Басты",
        tab_create: "Қосу",
        tab_profile: "Профиль"
      },
      ru: {
        profile_title: "Профиль",
        unsaved: "Не сохранено",
        saved: "Сохранено",
        edit_title: "Данные профиля",
        settings_title: "Быстрые настройки",

        lbl_name: "Имя",
        lbl_role: "Роль",
        lbl_phone: "Телефон",
        lbl_city: "Город",
        lbl_spec: "Специальность",

        phone_hint: "Номер используется для входа и уведомлений.",
        city_hint: "Помогает показывать мастеров рядом.",

        role_client: "Заказчик",
        role_master: "Мастер",

        spec_electrician: "Электрик",
        spec_plumber: "Сантехник",
        spec_builder: "Ремонт",
        spec_cleaner: "Уборка",

        btn_cancel: "Отмена",
        btn_save: "Сохранить",

        theme_title: "Тема",
        theme_sub: "Нажми, чтобы переключить",
        lang_title: "Язык",

        logout_title: "Выйти",
        logout_sub: "Завершить текущую сессию",
        logout_confirm_title: "Выйти из аккаунта?",
        logout_confirm_desc: "Ты сможешь снова войти по номеру телефона.",
        btn_logout: "Выйти",

        stat_orders: "Заказов",
        stat_rating: "Рейтинг",
        stat_saved: "Сохранено",

        tab_home: "Главная",
        tab_create: "Создать",
        tab_profile: "Профиль"
      }
    };

    /* ====== Toast (только для save/ошибок/важного) ====== */
    const toastWrap = document.getElementById('toastWrap');
    function showToast(message, type = 'info', timeout = 2200) {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `
        <div class="left">
          <div class="dot"></div>
          <div class="msg">${escapeHtml(message)}</div>
        </div>
        <button class="close" aria-label="close">&times;</button>
      `;
      toastWrap.appendChild(toast);
      requestAnimationFrame(() => toast.classList.add('show'));

      const remove = () => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 250);
      };
      toast.querySelector('.close').addEventListener('click', remove);
      setTimeout(remove, timeout);
    }
    function escapeHtml(str) {
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#039;');
    }

    /* ====== I18N ====== */
    function currentLang(){ return localStorage.getItem('lang') || 'kz'; }
    function t(key){
      const lang = currentLang();
      return (translations[lang] && translations[lang][key]) ? translations[lang][key] : key;
    }
    function applyLang() {
      const lang = currentLang();
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        if (translations[lang] && translations[lang][key]) el.innerText = translations[lang][key];
      });
      document.getElementById('langSub').innerText = (lang === 'ru') ? 'Қазақша / Русский' : 'Қазақша / Русский';
    }

    /* ====== Theme ====== */
    function initTheme(){
      const savedTheme = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', savedTheme);
      updateThemeSub();
    }
    function toggleTheme(){
      const cur = document.documentElement.getAttribute('data-theme') || 'dark';
      const next = cur === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      updateThemeSub();
      // без лишних тостов
    }
    function updateThemeSub(){
      const theme = document.documentElement.getAttribute('data-theme') || 'dark';
      document.getElementById('themeSub').innerText = theme === 'dark'
        ? (currentLang()==='ru' ? 'Сейчас: Тёмная' : 'Қазір: Қараңғы')
        : (currentLang()==='ru' ? 'Сейчас: Светлая' : 'Қазір: Ашық');
    }

    /* ===== UX фишка №1: Unsaved indicator + автосохранение (debounce) ===== */
    const saveDot = document.getElementById('saveDot');
    const saveText = document.getElementById('saveText');
    let dirty = false;
    let saveTimer = null;

    function setDirty(state){
      dirty = state;
      if (dirty){
        saveDot.classList.remove('saved');
        saveText.innerText = t('unsaved');
      } else {
        saveDot.classList.add('saved');
        saveText.innerText = t('saved');
      }
    }

    function scheduleAutoSave(){
      if (saveTimer) clearTimeout(saveTimer);
      saveTimer = setTimeout(() => {
        if (dirty) saveProfile(true); // тихое сохранение
      }, 900);
    }

    /* ===== Profile data ===== */
    const defaultProfile = {
      name: "Азамат",
      role: "client",
      phone: "+7 (707) 123-45-67",
      city: "Астана",
      spec: "electrician"
    };

    function loadProfile(){
      const raw = localStorage.getItem('profile');
      const profile = raw ? JSON.parse(raw) : defaultProfile;

      document.getElementById('nameInput').value = profile.name || '';
      document.getElementById('roleSelect').value = profile.role || 'client';
      document.getElementById('phoneInput').value = profile.phone || '';
      document.getElementById('cityInput').value = profile.city || '';
      document.getElementById('specSelect').value = profile.spec || 'electrician';

      syncRoleUI(profile.role || 'client');
      syncHero(profile);
      setDirty(false);
    }

    function getProfileFromForm(){
      return {
        name: document.getElementById('nameInput').value.trim(),
        role: document.getElementById('roleSelect').value,
        phone: document.getElementById('phoneInput').value.trim(),
        city: document.getElementById('cityInput').value.trim(),
        spec: document.getElementById('specSelect').value
      };
    }

    function syncHero(profile){
      const name = profile.name || '';
      document.getElementById('heroName').innerText = name || (currentLang()==='ru' ? 'Без имени' : 'Аты жоқ');
      document.getElementById('heroPhone').innerText = profile.phone || '—';
      document.getElementById('heroCity').innerText = profile.city || '—';
      document.getElementById('avatarLetter').innerText = (name[0] || 'S').toUpperCase();

      // badge
      const badge = document.getElementById('roleBadge');
      if (profile.role === 'master'){
        badge.innerText = 'Master';
        badge.style.background = 'rgba(0,201,255,0.14)';
        badge.style.borderColor = 'rgba(0,201,255,0.22)';
      } else {
        badge.innerText = 'Client';
        badge.style.background = 'rgba(0,242,160,0.12)';
        badge.style.borderColor = 'rgba(0,242,160,0.18)';
      }
    }

    function syncRoleUI(role){
      const masterFields = document.getElementById('masterFields');
      masterFields.style.display = (role === 'master') ? 'block' : 'none';
    }

    function resetForm(){
      loadProfile();
      showToast(currentLang()==='ru' ? 'Изменения отменены' : 'Өзгерістер жойылды', 'info', 1400);
    }

    /* ===== UX фишка №2: "тихое" сохранение + toast только при ручном сохранении/ошибках ===== */
    function saveProfile(silent=false){
      const profile = getProfileFromForm();

      if (!profile.name){
        showToast(currentLang()==='ru' ? 'Введите имя' : 'Есімді енгізіңіз', 'warn');
        return;
      }
      if (profile.phone.length < 5){
        showToast(currentLang()==='ru' ? 'Введите корректный телефон' : 'Телефонды дұрыс енгізіңіз', 'warn');
        return;
      }

      localStorage.setItem('profile', JSON.stringify(profile));
      syncHero(profile);
      setDirty(false);

      const savedCount = parseInt(document.getElementById('statSaved').innerText || '0', 10);
      document.getElementById('statSaved').innerText = isNaN(savedCount) ? 1 : savedCount + 1;

      if (!silent){
        showToast(currentLang()==='ru' ? 'Профиль сохранён' : 'Профиль сақталды', 'success');
      }
    }

    /* ===== UX фишка №3: подтверждение выхода (модалка) ===== */
    const logoutModal = document.getElementById('logoutModal');
    function openLogoutModal(){
      if (dirty){
        showToast(currentLang()==='ru' ? 'Сначала сохрани изменения' : 'Алдымен сақтаңыз', 'warn');
        return;
      }
      logoutModal.classList.add('active');
    }
    function closeLogoutModal(){ logoutModal.classList.remove('active'); }
    function logout(){
      closeLogoutModal();
      // тут обычно чистят токены/сессию. Для демо:
      showToast(currentLang()==='ru' ? 'Вы вышли' : 'Шықтыңыз', 'success', 1200);
      setTimeout(() => window.location.href = "index.html", 700);
    }

    /* Language picker (минимально, без модалки — просто переключение) */
    function openLangPicker(){
      const lang = currentLang();
      const next = (lang === 'kz') ? 'ru' : 'kz';
      localStorage.setItem('lang', next);
      applyLang();
      updateThemeSub();
      // без тоста
    }

    /* ===== Wire inputs ===== */
    function onAnyChange(){
      setDirty(true);
      scheduleAutoSave();
      const profile = getProfileFromForm();
      syncRoleUI(profile.role);
      syncHero(profile);
    }

    document.getElementById('nameInput').addEventListener('input', onAnyChange);
    document.getElementById('phoneInput').addEventListener('input', onAnyChange);
    document.getElementById('cityInput').addEventListener('input', onAnyChange);
    document.getElementById('roleSelect').addEventListener('change', onAnyChange);
    document.getElementById('specSelect').addEventListener('change', onAnyChange);

    /* Nav */
    function goHome(){ window.location.href = "home.html"; }
    function goCreate(){ showToast(currentLang()==='ru' ? 'Создание — скоро' : 'Қосу — жақында', 'info'); }
    function goBack(){ window.history.length > 1 ? window.history.back() : goHome(); }

    /* Init */
    initTheme();
    applyLang();
    loadProfile();

    // UX: keyboard Enter -> save (если фокус на input)
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter'){
        const tag = (document.activeElement && document.activeElement.tagName) ? document.activeElement.tagName.toLowerCase() : '';
        if (tag === 'input' || tag === 'select'){
          e.preventDefault();
          saveProfile(false);
        }
      }
      if (e.key === 'Escape'){
        closeLogoutModal();
      }
    });

    // UX: предупреждение если уходят с несохранёнными (на всякий)
    window.addEventListener('beforeunload', (e) => {
      if (dirty){
        e.preventDefault();
        e.returnValue = '';
      }
    });
  </script>
</body>
</html>
